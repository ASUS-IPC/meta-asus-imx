From 4d5eb8634b454f097d94226a930f6f92485fc3cd Mon Sep 17 00:00:00 2001
From: andy3_kuo <andy3_kuo@asus.com>
Date: Fri, 30 Apr 2021 10:59:59 +0800
Subject: [PATCH 2/2] fix build break

---
 CORE/CLD_TXRX/TXRX/ol_rx_defrag.c            | 2 +-
 CORE/CLD_TXRX/TXRX/ol_rx_reorder.c           | 2 +-
 CORE/CLD_TXRX/TXRX/ol_tx_send.c              | 2 +-
 CORE/CLD_TXRX/TXRX/ol_txrx_internal.h        | 2 +-
 CORE/HDD/inc/wlan_hdd_ftm.h                  | 1 -
 CORE/SERVICES/COMMON/wdi_out.h               | 2 +-
 CORE/SVC/src/logging/wlan_logging_sock_svc.c | 4 ++--
 CORE/VOSS/inc/vos_types.h                    | 4 ++++
 CORE/VOSS/src/vos_utils.c                    | 2 +-
 Kbuild                                       | 5 +++--
 10 files changed, 15 insertions(+), 11 deletions(-)

diff --git a/CORE/CLD_TXRX/TXRX/ol_rx_defrag.c b/CORE/CLD_TXRX/TXRX/ol_rx_defrag.c
index 29fc139bd..a272a2052 100644
--- a/CORE/CLD_TXRX/TXRX/ol_rx_defrag.c
+++ b/CORE/CLD_TXRX/TXRX/ol_rx_defrag.c
@@ -62,7 +62,7 @@
 #include <ol_ctrl_txrx_api.h>
 #include <ol_txrx_peer_find.h>
 #include <adf_nbuf.h>
-#include <ieee80211.h>
+#include <ieee80211_common.h>
 #include <adf_os_util.h>
 #include <athdefs.h>
 #include <adf_os_mem.h>
diff --git a/CORE/CLD_TXRX/TXRX/ol_rx_reorder.c b/CORE/CLD_TXRX/TXRX/ol_rx_reorder.c
index 1fc62d3ab..6d601d10d 100644
--- a/CORE/CLD_TXRX/TXRX/ol_rx_reorder.c
+++ b/CORE/CLD_TXRX/TXRX/ol_rx_reorder.c
@@ -30,7 +30,7 @@
 #include <adf_nbuf.h>          /* adf_nbuf_t, etc. */
 #include <adf_os_mem.h>        /* adf_os_mem_alloc */
 
-#include <ieee80211.h>         /* IEEE80211_SEQ_MAX */
+#include <ieee80211_common.h>         /* IEEE80211_SEQ_MAX */
 
 /* external interfaces */
 #include <ol_txrx_api.h>       /* ol_txrx_pdev_handle */
diff --git a/CORE/CLD_TXRX/TXRX/ol_tx_send.c b/CORE/CLD_TXRX/TXRX/ol_tx_send.c
index 007dfd418..46f026546 100644
--- a/CORE/CLD_TXRX/TXRX/ol_tx_send.c
+++ b/CORE/CLD_TXRX/TXRX/ol_tx_send.c
@@ -34,7 +34,7 @@
 
 #include <queue.h>            /* TAILQ */
 #ifdef QCA_COMPUTE_TX_DELAY
-#include <ieee80211.h>        /* ieee80211_frame, etc. */
+#include <ieee80211_common.h>        /* ieee80211_frame, etc. */
 #include <enet.h>             /* ethernet_hdr_t, etc. */
 #include <ipv6_defs.h>        /* IPV6_TRAFFIC_CLASS */
 #endif
diff --git a/CORE/CLD_TXRX/TXRX/ol_txrx_internal.h b/CORE/CLD_TXRX/TXRX/ol_txrx_internal.h
index 16f918623..1b256eb1c 100644
--- a/CORE/CLD_TXRX/TXRX/ol_txrx_internal.h
+++ b/CORE/CLD_TXRX/TXRX/ol_txrx_internal.h
@@ -39,7 +39,7 @@
 #include <ol_txrx_dbg.h>
 #include <enet.h>          /* ETHERNET_HDR_LEN, etc. */
 #include <ipv4.h>          /* IPV4_HDR_LEN, etc. */
-#include <ipv6.h>          /* IPV6_HDR_LEN, etc. */
+#include <ipv6_defs.h>          /* IPV6_HDR_LEN, etc. */
 #include <ip_prot.h>       /* IP_PROTOCOL_TCP, etc. */
 
 #ifdef ATH_11AC_TXCOMPACT
diff --git a/CORE/HDD/inc/wlan_hdd_ftm.h b/CORE/HDD/inc/wlan_hdd_ftm.h
index ef1675686..6aacde8c8 100644
--- a/CORE/HDD/inc/wlan_hdd_ftm.h
+++ b/CORE/HDD/inc/wlan_hdd_ftm.h
@@ -30,7 +30,6 @@
 #include "vos_status.h"
 #include "vos_mq.h"
 #include "vos_api.h"
-#include "msg.h"
 #include "halTypes.h"
 #include "vos_types.h"
 #include <wlan_ptt_sock_svc.h>
diff --git a/CORE/SERVICES/COMMON/wdi_out.h b/CORE/SERVICES/COMMON/wdi_out.h
index dcfccd273..6b1c1a3ad 100644
--- a/CORE/SERVICES/COMMON/wdi_out.h
+++ b/CORE/SERVICES/COMMON/wdi_out.h
@@ -42,7 +42,7 @@
 #ifdef WDI_API_AS_FUNCS
 
 #include <adf_os_types.h> /* u_int32_t */
-#include <ieee80211.h>    /* ieee80211_qosframe_htc_addr4 */
+#include <ieee80211_common.h>    /* ieee80211_qosframe_htc_addr4 */
 #include <enet.h>         /* LLC_SNAP_HDR_LEN */
 
 #if defined(CONFIG_HL_SUPPORT)
diff --git a/CORE/SVC/src/logging/wlan_logging_sock_svc.c b/CORE/SVC/src/logging/wlan_logging_sock_svc.c
index ac5dcc0d9..d2d178bb9 100644
--- a/CORE/SVC/src/logging/wlan_logging_sock_svc.c
+++ b/CORE/SVC/src/logging/wlan_logging_sock_svc.c
@@ -31,7 +31,7 @@
  ******************************************************************************/
 
 #ifdef WLAN_LOGGING_SOCK_SVC_ENABLE
-#include <vmalloc.h>
+#include <linux/vmalloc.h>
 #include <wlan_nlink_srv.h>
 #include <vos_status.h>
 #include <vos_trace.h>
@@ -39,7 +39,7 @@
 #include <wlan_logging_sock_svc.h>
 #include <vos_types.h>
 #include <vos_trace.h>
-#include <kthread.h>
+#include <linux/kthread.h>
 #include <adf_os_time.h>
 #include "pktlog_ac.h"
 #include <linux/rtc.h>
diff --git a/CORE/VOSS/inc/vos_types.h b/CORE/VOSS/inc/vos_types.h
index 623b37333..93bd417fa 100644
--- a/CORE/VOSS/inc/vos_types.h
+++ b/CORE/VOSS/inc/vos_types.h
@@ -41,7 +41,11 @@
   Include Files
   ------------------------------------------------------------------------*/
 #include "i_vos_types.h"
+#ifndef __KERNEL__
 #include <string.h>
+#else
+#include <linux/string.h>
+#endif /* __KERNEL__ */
 
 /*--------------------------------------------------------------------------
   Preprocessor definitions and constants
diff --git a/CORE/VOSS/src/vos_utils.c b/CORE/VOSS/src/vos_utils.c
index d6c4e7e92..06e40c151 100644
--- a/CORE/VOSS/src/vos_utils.c
+++ b/CORE/VOSS/src/vos_utils.c
@@ -76,7 +76,7 @@
 #ifdef CONFIG_CNSS
 #include <linux/qcomwlan_secif.h>
 #endif
-#include <errno.h>
+#include <linux/errno.h>
 
 #include "ieee80211_common.h"
 /*----------------------------------------------------------------------------
diff --git a/Kbuild b/Kbuild
index 9c655933e..3174296e9 100644
--- a/Kbuild
+++ b/Kbuild
@@ -19,7 +19,7 @@ ifeq ($(KERNEL_BUILD),1)
 	# These are provided in external module based builds
 	# Need to explicitly define for Kernel-based builds
 	MODNAME := wlan
-	WLAN_ROOT := drivers/staging/qcacld-2.0
+	WLAN_ROOT := $(srctree)/drivers/net/wireless/qcacld-2.0
 	WLAN_OPEN_SOURCE := 1
 endif
 
@@ -1097,7 +1097,8 @@ CDEFINES :=	-DANI_LITTLE_BYTE_ENDIAN \
 		-DWLAN_VOWIFI_DEBUG \
 		-DATH_SUPPORT_DFS \
 		-DWMI_COEX_BTC_DUTYCYCLE \
-		-Wno-misleading-indentation
+		-Wno-misleading-indentation \
+		
 #-Werror is omitted
 
 ifeq ($(CONFIG_WLAN_POWER_DEBUGFS), y)
-- 
2.25.1

